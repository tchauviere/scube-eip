{% extends 'ScubeBaseBundle:Base:core.base.html.twig' %}

{% block title %}Scube{% endblock %}

{% block more_javascripts %}
{% javascripts
    '@ScubeBaseBundle/Resources/public/js/core.grid.js' 
	'@ScubeBaseBundle/Resources/public/js/core.application.js' 
	'@ScubeBaseBundle/Resources/public/js/core.homebox.js' 
	'@ScubeBaseBundle/Resources/public/js/core.checkbox.js' 
%}
<script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}

<script>

	$(document).ready(function() 
	{
		load_Grid();
		start_application_loader();
		start_homebox_system('{{ path('_frame_profile') }}');
		
		
		{% image '@ScubeBaseBundle/Resources/public/images/empty.png' %}
			$("input:checkbox[name=grid_lock]").checkbox({empty:"{{ asset_url }}"});
			$("input:checkbox[name=grid_admin]").checkbox({empty:"{{ asset_url }}"});
		{% endimage %}
		
		
		start_checkbox_system();
	});

	$(window).resize(function() 
	{
		if (admin_mode == true)
			load_AdminGrid();
		else
			load_Grid();
	});


  var Widgets = {
				{% for widget in user.getBaseInterface().getWidgets() %}
					"cell_{{widget.id}}":{"id":{{widget.id}},"pos_x":{{widget.posX}},"pos_y":{{widget.posY}},"width":{{widget.width}},"height":{{widget.height}},"url":"{{ path(widget.widget.link)}}"},
				{% endfor %}
			  };
  var AdminWidgets = {
				{% for app in user.getPermissionsGroup().getAdminApplications() %}
					"cell_{{app.id}}":{"id":{{app.id}},"url":"{{ path(app.adminLink)}}","name":"{{ app.name}}"},
				{% endfor %}
			  };
			  
  var	cells_per_line = {{ dashboard_width.value }}/*7*/;
  var	nb_line = {{ dashboard_height.value }}/*5*/;

function	load_empty_cells()
{
	$(".empty_cell_hover").fancybox({
		  padding: 0,
		  openEffect : 'elastic',
		  openSpeed  : 150,
		  closeEffect : 'elastic',
		  closeSpeed  : 150,
		  autoScale:true,
		  type:'iframe',
		  helpers : {
		  overlay : null
		  },
		  href:"{{ path("ScubeMyAppsBundle_add_widget")}}"
	});
}

function	unload_empty_cells()
{
	$(".empty_cell_hover").click(function() {
		});
}
			  
function	load_widget(id, force)
{
	if ($("#"+id+" .widget_content").length == 0 || force)
		$.ajax({
		  url: Widgets[id]["url"],
		  beforeSend: function() {			
			$("#"+id).append("<div class='widget_content'></div>");
		  },
		  success: function(data) {			
			$("#"+id+" .widget_content").html(data);
			/*if ($("#"+id+" .widget_content .GridButton").length)
				$("#"+id+" .widget_content").click(function() {
					$("#"+id+" .widget_content").fancybox({
						  padding: 0,
						  openEffect : 'elastic',
						  openSpeed  : 150,
						  closeEffect : 'elastic',
						  closeSpeed  : 150,
						  autoScale:true,
						  type:'iframe',
						  helpers : {
						  overlay : null
						  },
						  href:$("#"+id+" .widget_content .GridButton").attr("openapp")
					});
				});*/
		  }
		});
}

function	load_adminWidget(id, force)
{
	/* LE HREF DANS LA DIV PEUT POSER PROBLEME */
	$("#"+id).append('<div class="widget_content AppBox" href="'+AdminWidgets[id]['url']+'"><div class="GridButton"><p class="GridButton_title">'+AdminWidgets[id]['name']+'</p></div></div>');
}

function	save_moving_position(id, pos_x, pos_y)
{
	$.ajax({
		  url: "{{ path("ScubeMyAppsBundle_save_widget_position_noparam") }}/"+Widgets[id]['id']+"/"+pos_x+"/"+pos_y
		});
}

function	delete_widget_from_grid(id)
{
	$.ajax({
		  url: "{{ path("ScubeMyAppsBundle_delete_widget_noparam") }}/"+Widgets[id]['id'],
		  success: function(data) {	location.reload(); }
		});
}
			  
</script>

<style>

.fancybox-nav {
	{% image '@ScubeBaseBundle/Resources/public/images/blank.gif' %}
		background-image:transparent  url({{ asset_url }}); /* helps IE */
	{% endimage %}
}

.cell_fullscreen {
	{% image '@ScubeBaseBundle/Resources/public/images/fullscreen.png' %}
		background:transparent url({{ asset_url }}) top left no-repeat;
	{% endimage %}
}
.cell_fullscreen:hover {
	{% image '@ScubeBaseBundle/Resources/public/images/fullscreen_hover.png' %}
		background:transparent url({{ asset_url }}) top left no-repeat;
	{% endimage %}
}
.cell_remove {
	{% image '@ScubeBaseBundle/Resources/public/images/remove.png'	%}
		background:transparent url({{ asset_url }}) top left no-repeat;
	{% endimage %}
}

.cell_anchor {
	{% image '@ScubeBaseBundle/Resources/public/images/anchor.png'	%}
		background:transparent url({{ asset_url }}) top left no-repeat;
	{% endimage %}
}

.empty_cell_hover {
	{% image '@ScubeBaseBundle/Resources/public/images/background_cell_hover.png'	%}
		background:url({{ asset_url }}) center no-repeat;
	{% endimage %}
}

.jquery-checkbox img {
	{% image '@ScubeBaseBundle/Resources/public/images/checkbox.png'	%}
		background: transparent url({{ asset_url }}) no-repeat;
	{% endimage %}
}

body {
	overflow:hidden;
}

</style>

{% endblock %}

{% block body %}
{{ parent() }}

<div id="Application_loader">
	{% image '@ScubeBaseBundle/Resources/public/images/application_loader.gif' %}
		<img src="{{ asset_url }}" alt="Loading.." />
	{% endimage %}
</div>

<div id="Application_closer">
	{% image '@ScubeBaseBundle/Resources/public/images/close_application.png' %}
		<img src="{{ asset_url }}" alt="Close" />
	{% endimage %}
</div>

<div id="Application_suspender">
	{% image '@ScubeBaseBundle/Resources/public/images/suspend_application.png' %}
		<img src="{{ asset_url }}" alt="Suspend" />
	{% endimage %}
</div>

<div id="mcs_container">
	<div class="customScrollBox">
		<div class="container">
    		<div class="content">
        		<div id="Grid">

				</div>
			</div>
		</div>
		<div class="dragger_container">
    		<div class="dragger"></div>
		</div>
	</div>
</div>

{% endblock %}