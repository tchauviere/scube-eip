{% extends 'ScubeBaseBundle:Base:core_application.html.twig' %}

{% block more_javascripts %}
{% javascripts
	'@ScubeAccountBundle/Resources/public/js/jquery.min.js'
    '@ScubeAccountBundle/Resources/public/js/jquery.Jcrop.js'	
	'@ScubeAccountBundle/Resources/public/js/jquery.Jcrop.min.js' 
%}

<script type="text/javascript" src="{{ asset_url }}"></script>

<style>
.jcrop-holder { text-align: left; }

.jcrop-vline, .jcrop-hline
{
	font-size: 0;
	position: absolute;
	background: white url('Jcrop.gif') top left repeat;
}
.jcrop-vline { height: 100%; width: 1px !important; }
.jcrop-hline { width: 100%; height: 1px !important; }
.jcrop-handle {
	font-size: 1px;
	width: 7px !important;
	height: 7px !important;
	border: 1px #eee solid;
	background-color: #333;
	*width: 9px;
	*height: 9px;
}

.jcrop-tracker { width: 100%; height: 100%; }

.custom .jcrop-vline,
.custom .jcrop-hline
{
	background: yellow;
}
.custom .jcrop-handle
{
	border-color: black;
	background-color: #C7BB00;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
}
</style>

{% endjavascripts %}

		<script>
		$(window).load
		(
			function()
			{ 
			$('#cropimg').submit(function(e)
				{
					var arrayEdit = new Array();
					x = $('#x').val;
					y = $('#y').val;
					h = $('#h').val;
					w = $('#w').val;
					arrayEdit.push(x, y, h, w);
					$.post("{{path('ScubeAccountBundle_crop_profile_picture')}}", {'array_edit': arrayEdit});
				});
			
				var jcrop_api = $('#cropbox').Jcrop
				(
					{
						onSelect: showCoords,
						onChange: showPreview,
						aspectRatio: 1,
						allowMove: 1
					},
					function()
					{
	        			// Use the API to get the real image size
				        var bounds = this.getBounds();
				        boundx = bounds[0];
				        boundy = bounds[1];
				        // Store the API in the jcrop_api variable
				        jcrop_api = this;
			      }
				);
				
				function showCoords(coords)
				{
					$('#x').val(coords.x);
					$('#y').val(coords.y);
					$('#w').val(coords.w);
					$('#h').val(coords.h);
				};
			
			
				function showPreview(coords)
				{
				
					$('#x1').val(coords.x);
					$('#y1').val(coords.y);
					$('#x2').val(coords.x2);
					$('#y2').val(coords.y2);
					$('#w').val(coords.w);
					$('#h').val(coords.h);
					if (parseInt(coords.w) > 0)
					{
						var rx = 100 / coords.w;
						var ry = 100 / coords.h;

						jQuery('#preview').css
						(
							{
								width: Math.round(rx * boundx) + 'px',
								height: Math.round(ry * boundy) + 'px',
								marginLeft: '-' + Math.round(rx * coords.x) + 'px',
								marginTop: '-' + Math.round(ry * coords.y) + 'px'
							}
						);
					}
				}
			}
		);
		</script>

		
		{% endblock %}
{% block body %}
{{ parent() }}

<div class="Application">

<table class="table_content">
<tr>
	<td class="sidebar_left">
		{% include 'ScubeAccountBundle:Account:menu.html.twig' %}
	</td>
	<td class="sidebar_main">
		<h1>Edit picture</h1>

		{% if success %}
			<p class="form_success">Your profile has been successfully updated.</p>
		{% endif %}
		
		<!-- <p style="text-align:center;"> --> <img align="center"  height="120" src="{{ user.getProfile().getPicture() }}" alt="Your profile picture" id="cropbox"/>
		<div style="width:100px;height:100px;overflow:hidden;">
			<img align="center" src="{{ user.getProfile().getPicture() }}" alt="Your profile picture" id="preview"/>
		</div>
		
		<form action="{{ path('ScubeAccountBundle_crop_profile_picture') }}" method="post" {{ form_enctype(form) }}>
			{{ form_widget(form) }}
		<input type="submit" value="Crop Image" />
		<input type="hidden" id="x" name="x" />
		<input type="hidden" id="y" name="y" />
		<input type="hidden" id="h" name="h" />
		<input type="hidden" id="w" name="w" />
			
		</form>
		
	</td>
</tr>
</table>

</div>
{% endblock %}
